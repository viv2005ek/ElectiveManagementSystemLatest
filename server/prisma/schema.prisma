generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("EMS_DEV")
}

model StudentCredential {
  id                 String @id @default(uuid())
  registrationNumber String @unique
  email              String @unique
  passwordHash       String
}

model FacultyCredential {
  id                 String @id @default(uuid())
  registrationNumber String @unique
  email              String @unique
  passwordHash       String
}

model AdminCredential {
  id                 String @id @default(uuid())
  registrationNumber String @unique
  email              String @unique
  passwordHash       String
}

model Student {
  id                            String                         @id @default(uuid())
  registrationNumber            String                         @unique
  email                         String                         @unique
  firstName                     String
  lastName                      String?
  semester                      Int
  DepartmentId                  String
  DepartmentName                String
  BranchId                      String
  BranchName                    String
  MinorSpecializationPreference MinorSpecializationPreference?
  ProgrammeElectivePreferences  ProgrammeElectivePreference[]
}

model Faculty {
  id                       String                              @id @default(uuid())
  registrationNumber       String                              @unique
  email                    String                              @unique
  firstName                String
  lastName                 String?
  FacultyElectiveAllotment FacultyProgrammeElectiveAllotment[]
}

model Admin {
  id                 String  @id @default(uuid())
  registrationNumber String  @unique
  email              String  @unique
  firstName          String
  lastName           String?
}

model Department {
  id                  String                @id @default(uuid())
  name                String                @unique
  branches            Branch[]              @relation("DepartmentBranches")
  MinorSpecialization MinorSpecialization[]
}

model Branch {
  id           String     @id @default(uuid())
  name         String     @unique
  departmentId String
  department   Department @relation("DepartmentBranches", fields: [departmentId], references: [id])
}

model ProgrammeElective {
  id                                String                        @id @default(uuid())
  courseCode                        String                        @unique
  name                              String                        @unique
  semester                          Int
  isStandalone                      Boolean                       @default(false)
  minorSpecializationId             String?
  MinorSpecialization               MinorSpecialization?          @relation(fields: [minorSpecializationId], references: [id])
  ProgrammeElectiveFirstPreference  ProgrammeElectivePreference[] @relation("FirstPreference")
  ProgrammeElectiveSecondPreference ProgrammeElectivePreference[] @relation("SecondPreference")
  ProgrammeElectiveThirdPreference  ProgrammeElectivePreference[] @relation("ThirdPreference")
}

model ProgrammeElectiveAllotment {
  id                 String @id @default(uuid())
  studentId          String
  electiveId         String
  electiveName       String
  electiveCourseCode String
  allotmentSemester  Int
}

model FacultyProgrammeElectiveAllotment {
  id                 String  @id @default(uuid())
  facultyId          String
  faculty            Faculty @relation(fields: [facultyId], references: [id])
  electiveId         String
  electiveName       String
  electiveCourseCode String
  allotmentSemester  Int
}

model MinorSpecializationPreference {
  id                 String              @id @default(uuid())
  studentId          String              @unique
  student            Student             @relation(fields: [studentId], references: [id])
  firstPreferenceId  String
  firstPreference    MinorSpecialization @relation("FirstPreference", fields: [firstPreferenceId], references: [id])
  secondPreferenceId String
  secondPreference   MinorSpecialization @relation("SecondPreference", fields: [secondPreferenceId], references: [id])
  thirdPreferenceId  String
  thirdPreference    MinorSpecialization @relation("ThirdPreference", fields: [thirdPreferenceId], references: [id])
  createdAt          DateTime            @default(now())
}

model ProgrammeElectivePreference {
  id                 String             @id @default(uuid())
  studentId          String
  student            Student            @relation(fields: [studentId], references: [id])
  semester           Int
  firstPreferenceId  String?
  firstPreference    ProgrammeElective? @relation("FirstPreference", fields: [firstPreferenceId], references: [id])
  secondPreferenceId String?
  secondPreference   ProgrammeElective? @relation("SecondPreference", fields: [secondPreferenceId], references: [id])
  thirdPreferenceId  String?
  thirdPreference    ProgrammeElective? @relation("ThirdPreference", fields: [thirdPreferenceId], references: [id])
  createdAt          DateTime           @default(now())
}

model MinorSpecialization {
  id                                  String                          @id @default(uuid())
  name                                String                          @unique
  departmentId                        String
  department                          Department                      @relation(fields: [departmentId], references: [id])
  ProgrammeElectives                  ProgrammeElective[]
  MinorSpecializationFirstPreference  MinorSpecializationPreference[] @relation("FirstPreference")
  MinorSpecializationSecondPreference MinorSpecializationPreference[] @relation("SecondPreference")
  MinorSpecializationThirdPreference  MinorSpecializationPreference[] @relation("ThirdPreference")
}
